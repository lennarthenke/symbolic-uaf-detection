# syntax=docker/dockerfile:1
FROM ubuntu:18.04

# Install required dependencies
RUN apt-get update && \
    apt-get install -y \
    build-essential \
    wget

# Download and extract Binutils 2.31.1 source code
RUN wget https://ftp.gnu.org/gnu/binutils/binutils-2.31.1.tar.gz && \
    tar xzf binutils-2.31.1.tar.gz && \
    rm binutils-2.31.1.tar.gz

# Configure the build with debug symbols enabled, optimization disabled, and PIE disabled
WORKDIR /binutils-2.31.1
RUN ./configure \
    --prefix=/usr/local/binutils-2.31.1 \
    --disable-nls \
    --enable-debug \
    --disable-werror \
    CFLAGS="-O0 -g3" \
    LDFLAGS="-no-pie"

# Compile and install Binutils
RUN make && \
    make install

# Copy the compiled binaries to a dedicated folder
RUN mkdir /compiled-binaries && \
    cp /usr/local/binutils-2.31.1/bin/* /compiled-binaries/

# Set the entrypoint
ENTRYPOINT ["/bin/bash"]
